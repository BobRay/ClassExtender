<p>ClassExtender is designed to make it easy to extend the <code>modUser</code> and <code>modResource</code> objects in MODX. It will not only extend the objects for you, it also gives you tools update them in the database, and search for your extended objects and display them. I want to acknowledge the support provided by Kindem Designs in the initial stages of developing this extra.</p>

<p>As you probably know, most of the information on a user is contained in the User Profile. Often, however, you need to store information about a user that won't fit there. Using the Profile's extended fields is an option, but it's very slow and inefficient to search or sort users based on what is in their extended fields. Extending the <code>modUser</code> object essentially gives you an extra user profile with as many fields as you need to store your information. Having the information there will allow you to do extremely fast searches on the extended data and sort the results.</p>

<p>The traditional method of extending <code>modUser</code> is documented <a href="http://rtfm.modx.com/revolution/2.x/developing-in-modx/advanced-development/extending-moduser" target="_blank">here</a>. Extending <code>modResource</code> is documented <a href="http://rtfm.modx.com/revolution/2.x/developing-in-modx/advanced-development/custom-resource-classes/creating-a-resource-class" target="_blank"> here</a>. You don't need to consult those pages to use ClassExtender, but doing so may help you understand what it's doing. It will also give you an appreciation of how much time and trouble ClassExtender is saving you.</p>
<br />

<div class="box">
<p>It's *very* strongly recommended that you not change any of the values in the ClassExtender forms or snippet tags used to extend the <code>modUser</code> and <code>modResource</code> objects. There's really no reason to change them unless you want to extend some other object. Simply select the options with the radio buttons at the bottom of the form and click on &quot;Submit&quot;. This tutorial will assume that you've left the input fields and properties at their default values.</p>
</div>

<br />
<p>Once the class and map files have been created and the data is in the extra fields in the custom database table, getting the data in those extra fields is quite easy. All you need to do is have the user object and call <code>$user->getOne('Data')</code>.</p>

<p>Extending the <code>modResource</code> object does the same thing for that object. It provides an extra table to store the additional information you need for each resource. Having the data in the extra table is *much* faster and more efficient than storing it in Template Variables. Doing so will allow blindingly fast and efficient searching and sorting on those fields and will mean much faster page loads when displaying the fields. As with the extended <code>modUser</code> object, getting the extra data is simply a matter of calling <code>$resource->getOne('Data');</code></p>

<h3>Installing ClassExtender</h3>

<p>
Go to System | Package Management on the main menu in the MODX Manager and click on the &quot;Download Extras&quot; button. That will take you to the Revolution Repository. Put ClassExtender in the search box and press Enter. Click on the &quot;Download&quot; button, and once the package is downloaded,  click on the &quot;Back to Package Manager&quot; button. That should bring you back to your Package Management grid. Click on the &quot;Install&quot; button next to ClassExtender in the grid. The ClassExtender package should now be installed.</p>

<h3>Overview</h3>

<p>We'll cover this in more detail below, but the basic process for extending either object is to modify the example object schema chunk to meet your needs or create the table you want, then view either the &quot;Extend modUser&quot; resource or the &quot;Extend modResource&quot; resource. That will present you with a form that, when submitted, will do all the work for you. It will create the class and map files, register the extension package, and (optionally) update the class key of all existing objects in the database. Once that's done, all that's left is to modify the chunk used to display the extra fields in the Create/Edit Resource or User panel in the Manager, and enable the plugin that displays them. If any of your fields require special handling (e.g., a date field that should be set to today's date), you'll also have to modify the plugin to handle that.</p>

<h3>Schema or Table?</h3>

<p>In order to add the extra fields to your extended object, you need to create a specification for the fields. The most direct way is by creating a schema. There are two example schema chunks in the package: ExtUserSchema and ExtResourceSchema. You can modify them to meet your needs before running either snippet (the two snippets are run by viewing the &quot;Extend modUser&quot; or the  &quot;Extend modResource&quot; resources). ClassExtender uses a schema file to do its work, but the first thing it does if you've selected the &quot;User Schema&quot; radio option is to dump the appropriate chunk's content to the file.</p>

<p>If you prefer, instead of creating the schema, you can simply create your table in the database and select the &quot;Use Table&quot; radio option. ClassExtender will use the table to create a schema for you. The schema chunk will also be updated with the generated schema, so you may want to save the original example schemas somewhere safe first. For convenience, your table should be called <code>ext_user_data</code> or <code>ext_resource_data.</code>It should have an <code>id</code> field (the primary key) and a field called either <code>resourcedata_id</code> or <code>userdata_id</code>, and of course all the extra fields you want for your object.</p>

<p>Once you have submitted the appropriate ClassExtender form, the schema chunk will contain the updated schema. You can examine it and make any necessary changes, then drop (remove) the table from the DB, submit the form again, and your changes will be implemented.</p>

<h3>A Recommendation</h3>

<p>This is entirely up to you, but I would recommend performing the entire process using the examples provided with ClassExtender. You'll see how everything works and can verify that ClassExtender operates as it should before trying to create your own extended classes. Once the process is completed, you can drop the existing database table or modify it to meet your needs and repeat the steps using your own schema or table. ClassExtender will generate completely new class and map files every time it runs so the example ones will be overwritten with yours.</p>

<h3>The Examples</h3>

<p>The files and objects included with ClassExtender serve as examples that you can modify to meet your needs.</p>

<p>The User examples are something I did for a client on a site where the users work in cooking-related businesses. The client needed extra fields for <code>firstName</code>, <code>lastName</code>, <code>title</code>, <code>registrationDate</code>, <code>company</code>, and three categories. The categories are shown as a drop-down list on the form (the categories are in the UserCategories chunk). The <code>registrationDate</code> field is not shown on the form. It's set to today's date only if the field in the database is empty. The ExtraUserFields chunk contains the HTML to show the fields on the Create/Edit User panel. The ExtraUserFields plugin displays the chunks and saves the values to the database.</p>
        
<p>The Resource examples are for an imaginary site where each resource represents an animal (at, say, a shelter, pet shop, or veterinary clinic). There are extra fields for the <code>name</code>, <code>color</code>, <code>breed</code>, and <code>age</code> of the animal. The ExtraResourceFields chunk contains the HTML to show the fields on the Create/Edit Resource panel. The ExtraResourceFields plugin displays the chunks and saves the values to the database.</p>

<h3>Extending modUser</h3>

<p>Here are the basic steps necessary to extend the <code>modUser</code> object:

<ol>
    <li>Modify the ExtUserSchema chunk to meet your needs (or create your table as described above)</li>
    <li>Go to Reports | Error Log and clear the Error Log</li>
    <li>View the &quot;Extend modUser&quot; resource</li>
    <li>Select either the &quot;Use Schema&quot; (the default) or &quot;Use Table&quot; radio option</li>
    <li>*DO NOT* select the option to update the <code>class_key</code> of existing objects</li>
    <li>Click on Submit</li>
    <li>Once the process is completed, select the option to update the <code>class_key</code> and click on Submit again</li>
    <li>Modify the ExtraUserFields chunk to display your extra fields</li>
    <li>Enable the ExtraUserFields plugin, which will display and save the fields</li>
    <li>If necessary, modify the ExtraUserFields plugin to deal with fields that require special handling</li>
    <li>Go to Reports | Error Log and clear the Error Log (there will be some spurious error messages there)</li>
    
    
</ol>

<p>Why do you submit twice? This is very important. If you update the <code>class_key</code> on the first pass, you may be temporarily locked out of the Manager, since the necessary class and map files are not available and MODX won't find your user record. If you forget and this happens, manually delete all files in the <code>core/cache</code> directory, and reload the page in your browser. In some cases, you may also need to clear your browser cache and cookies.</p>

<p>Once you've completed the steps above, you should see your extra fields on the Create/Edit User panel and they should be saved to the <code>ext_user_data</code> table in the database.</p>
        

<h3>Extending modResource</h3>

<p>Here are the basic steps necessary to extend the <code>modResource</code> object:

<ol>
    <li>Modify the ExtResourceSchema chunk to meet your needs (or create your table as described above)</li>
    <li>Go to Reports | Error Log and clear the Error Log</li>
    <li>View the &quot;Extend modResource&quot; resource</li>
    <li>Select either the &quot;Use Schema&quot; (the default) or &quot;Use Table&quot; radio option</li>
    <li>*DO NOT* select the option to update the <code>class_key</code> of existing objects</li>
    <li>Click on Submit</li>
    <li>Once the process is completed, select the option to update the <code>class_key</code> and click on Submit again</li>
    <li>Modify the ExtraResourceFields chunk to display your extra fields</li>
    <li>Enable the ExtraResourceFields plugin, which will display and save the fields</li>
    <li>If necessary, modify the ExtraResourceFields plugin to deal with fields that require special handling</li>
    <li>Go to Reports | Error Log and clear the Error Log (there will be some spurious error messages there)</li>
    
    
</ol>

<p>Why do you submit twice? This is very important. If you update the <code>class_key</code> on the first pass, your resources will disappear from the Resource tree, since the necessary class and map files are not available and the code that renders the tree won't find them. This means that you can't run ClassExtender again. If you forget and this happens, manually delete all files in the <code>core/cache</code> directory, and reload the page in your browser. In some cases, you may also need to clear your browser cache and cookies.</p>
        
<p>Once you've completed the steps above, you should see your extra fields on the Create/Edit Resource panel and they should be saved to the <code>ext_resource_data</code> table in the database.</p>

<h3>Using Your Extended Class</h3>

<p>Because the packages for either extended class are registered in the <code>extension_packages</code> System Setting, they will be available on every page load (including Manager pages). This means there is almost never a need to call <code>addPackage()</code> or <code>loadClass()</code> for them.</p>

<p>Once you have run ClassExtender for an extended class, you can call any xPDO method that uses the class anywhere in MODX (though you may need to clear the cache once). The only situation where you would need to load the class or package explicitly might be for part of a CMP (e.g., a connector or processor) or code to be run outside of MODX where there is no request. In those cases, you should call <code>addPackage()</code>, <code>loadClass()</code>, or <code>$modx->getService()</code> as appropriate.</p>

<h3>Troubleshooting</h3>

<p>If your extra fields fail to show up in the Create/Edit User or Resource forms in the Manager, make sure you've enabled the appropriate plugin in the ClassExtender category.</p>

<p>Since ClassExtender is altering basic MODX classes, things can temporarily get a little strange. If you forget the advice above about making two passes to create your extended class, resources may disappear from the tree or users may disappear from the user grid. *DON'T PANIC* &mdash; nothing is gone. Sometimes just clearing the cache and reloading the page will solve things, but usually it's necessary to delete all files in the <code>core/cache</code> directory. Once you do that, everything should be back to normal.</p>

<p>In the worst case, if you have made a mistake in the ClassExtender form fields, you can edit the database directly and revert the <code>class_key</code> of a resource or user back to <code>modResource</code> or <code>modUser</code>. You can also uninstall ClassExtender, which will revert all the <code>class_key</code> fields for you.</p>

<p>If you uninstall ClassExtender, under certain circumstances the Manager may get confused and continue trying to load the class (which is no longer there). You'll see a message saying it can't find the action file no matter what you try to do. Again, the solution is to delete all files in the <code>core/cache</code> directory.</p>
        

<h3>Utilities</h3>

<p>There are several utility snippets included with ClassExtender. They may do what you want, or you may need to modify them.</p>

<p>The simplest of the utilities are SetUserPlaceholders and SetResourcePlaceholders. These simply set placeholders for the extra fields. Both take a property (<code>&userId</code> or <code>&resourceId</code> that lets you select the user or resource to get the fields for. If those are omitted, the current user or current resource is assumed.</p>

<p>For example, to show the extra field values for the current resource (using the included example fields), you could do this:</p>

<pre class="brush: html; toolbar: false;"><fixedpre>
[[!SetResourcePlaceholders]]

<p>Name:  [[+name]]</p>
<p>Color: [[+color]]</p>
<p>Breed: [[+breed]]</p>
<p>Age:   [[+age]]</p>
</fixedpre></pre>


<p>The package also includes two snippets: getExtUsers and getExtResources. These operate a little like getResources, only without all the bells and whistles. They use Tpl chunks to display sorted, aggregated Users or Resources based on some search criteria. You can specify the Tpl chunks, sorting, and selection criteria in the properties. Here are some examples:</p>

<pre class="brush: php; toolbar: false;"><fixedpre>

// Get All users with the first name 'Bob':

[[!getExtUsers?
    &where=`{"Data.firstName:=":"Bob"}`
    &sortby=`Data.LastName`
    &sortDir=`ASC`
]]


// Get all Users with 'Chef' as a category:

[[!getExtUsers?
    &where=`{"Data.category1:=":"Chef","OR:Data.category2:=":"Chef","OR:Data.category3:=":"Chef"}`
    &sortby=`Data.LastName`
    &sortDir=`ASC`
]]

// Get All resources where the breed is 'poodle':

[[!getExtResources?
    &where=`{"Data.breed:=":"poodle"}`
    &sortby=`pagetitle`
    &sortDir=`ASC`
]]
</fixedpre></pre>

<p>The content of the <code>&where</code> property is just as it is for other xPDO-based snippets like getResources. There are some examples <a href="http://rtfm.modx.com/extras/revo/getresources#getResources-Examples" target="_blank"> here</a>.</p>

<p>In the <code>&where</code> property for Users with ClassExtender, regular user fields should have no prefix (e.g., <code>username</code>), Profile fields should be prefixed with <code>Profile.</code> (e.g., Profile.email), and your extra fields should be prefixed with <code>Data.</code> (e.g., <code>Data.company</code>).</p>

<p>With the getExtUsers snippet, you can use the username, active, and all fields in the Profile and Data tables as placeholders in the Tpl chunks.</p>

<p>Similarly, for Resource criteria, regular resource fields should have no prefix (e.g., <code>pagetitle</code>), and your extra fields should be prefixed with <code>Data.</code> (e.g., <code>Data.breed</code>).</p>

<p>With the getExtResources snippet, you can use all standard resource fields and all fields in the Data tables as placeholders in the Tpl chunks.</p>

<p>The getExtResources snippet will not select or display Template Variables (TVs). Adding generic TV capability would have made the snippet quite slow and would defeat the purpose of moving TV data into the extra fields. If you absolutely need TVs, it will be much more efficient to modify the getExtResources snippet code to display the particular TVs you need, and searching or sorting by TVs is a bad idea to begin with.</p>

<p>There are two other utility snippets: ExtUserUpdateProfile and UserSearchForm. The first shows how to extend the UpdateProfile snippet (part of the Login package) to display and update the extra user fields. In simple cases, you may be able to just add the fields to the Update Profile page and add a tag for the snippet on the page. The second (UserSearchForm) serves as an example of how to search for users by category. Either snippet may need to be modified to be of any user other than as an example. </p>
        
        
<h3>Extending Other MODX Objects</h3>

<p>ClassExtender should also extend other MODX objects, though I haven't tested this. By changing the properties in the ClassExtender snippet tag, and possibly the fields in the form, you should be able to extend any MODX object, though some objects may require some custom code. You'll also have to create the plugin and chunk necessary to modify the Create/Edit object form and save the data, but you can copy the existing plugin and chunk. The necessary changes should be minor.</p>
        
<h3>Uninstalling ClassExtender</h3>
        
<p><b>Important</b>: Even though ClassExtender only needs to be run once to create the class and map files for the extended classes, DO NOT uninstall it unless you will not be using any extended classes. The class and map files, the namespace, and any database tables will be removed during the uninstall.</p>

<p>When you uninstall ClassExtender, you'll see some error messages in red. This is normal. There will also be some spurious error messages in the MODX Error Log.</p>

<p>During the uninstall, ClassExtender will remove its various components and namespace, revert the <code>class_key</code> of the objects in the database, de-register the extension package(s), and drop any tables it created. When the uninstall is finished, there should be no trace of ClassExtender left on your site. Note that any data stored in the ClassExtender tables will be lost.</p>

<h3>A Word of Warning</h3>

<p>In order to get the most out of the extended objects created by ClassExtender, you will probably need some knowledge of PHP in order to modify the code to do what you want. You'll also need to either modify the XML schema or create your own PHP table to hold the data, though neither of these is particularly difficult. Standard MODX extras like getResources won't know about your extra fields, so they'll need to be modified to include them, though they'll still work find in cases where you don't need to display the extra fields.</p>

<p>ClassExtender will be of limited use with Articles, since Articles itself extends <code>modResource</code>. ClassExtender will still work with non-Articles resources, but probably not with your blog posts. The Discuss extra extends <code>modUser</code>, but as far as I can tell, it keeps separate tables and will work side-by-side with ClassExtender.</p>

<h3>ClassExtender Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>package</td>
        <td>Name of the package being created (e.g., extendeduser, extendedresource)</td>
        <td>empty</td>
    </tr>
    <tr>
        <td>class</td>
        <td>Name of class being created (e.g., extUser, extResource)</td>
        <td>empty</td>
    </tr>
    <tr>
        <td>parentObject</td>
        <td>Class that the object being created extends (e.g., modUser, modResource)</td>
        <td>empty</td>
    </tr>
    <tr>
        <td>tablePrefix</td>
        <td>Table prefix for new DB table</td>
        <td>ext_</td>
    </tr>
    <tr>
        <td>tableName</td>
        <td>Name for DB table without the prefix (e.g., user_data, resource_data)</td>
        <td>empty</td>
    </tr>
    <tr>
        <td>method</td>
        <td>Method to use for creating class and map files; must be use_table or user_schema</td>
        <td>use_schema</td>
    </tr>

    <tr>
        <td>updateClassKey</td>
        <td>If set, the class_key field for all existing objects will be updated when the class is created -- leave this set to No and use
            the form to update the class_keys
        </td>
        <td>No</td>
    </tr>
</table>



<h3>GetExtUsers Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>extUserInnerTpl</td>
        <td>Name of inner Tpl chunk to use for user listing</td>
        <td>extUserInnerTpl</td>
    </tr>
    <tr>
        <td>extUserOuterTpl</td>
        <td>Name of outer Tpl chunk to use for user listing</td>
        <td>extUserOuterTpl</td>
    </tr>
    <tr>
        <td>extUserRowTpl</td>
        <td>Name of row Tpl chunk to use for user listing -- displays individual user data</td>
        <td>extUserRowTpl</td>
    </tr>
    <tr>
        <td>userClass</td>
        <td>Class for user object</td>
        <td>extUser</td>
    </tr>
    <tr>
        <td>where</td>
        <td>JSON string containing query criteria</td>
        <td>empty</td>
    </tr>
    <tr>
        <td>sortby</td>
        <td>Field to sort by (e.g., username, Profile.fullname, Data.lastname)</td>
        <td>username</td>
    </tr>
    <tr>
        <td>sortdir</td>
        <td>Direction to sort in (ASC, DESC)</td>
        <td>ASC</td>
    </tr>
</table>

<h3>GetExtResources Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>extResourceInnerTpl</td>
        <td>Name of inner Tpl chunk</td>
        <td>ExtResourceInnerTpl</td>
    </tr>
    <tr>
        <td>extResourceOuterTpl</td>
        <td>Name of outer Tpl chunk</td>
        <td>ExtResourceOuterTpl</td>
    </tr>
    <tr>
        <td>extResourceRowTpl</td>
        <td>Name of row Tpl chunk</td>
        <td>ExtResourceRowTpl</td>
    </tr>
    <tr>
        <td>resourceClass</td>
        <td>Name of extended resource class</td>
        <td>extResource</td>
    </tr>
    <tr>
        <td>sortby</td>
        <td>Field to sort by (e.g., pagetitle, Data.somefield)</td>
        <td>pagetitle</td>
    </tr>
    <tr>
        <td>sortdir</td>
        <td>Direction to sort in (ASC, DESC)</td>
        <td>ASC</td>
    </tr>
    <tr>
        <td>where</td>
        <td>JSON string with search criteria</td>
        <td>empty</td>
    </tr>
</table>

<h3>SetUserPlaceholders Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>userId</td>
        <td>User ID</td>
        <td>empty (defaults to current user)</td>
    </tr>
    <tr>
        <td>prefix</td>
        <td>Prefix for placeholders</td>
        <td>empty</td>
    </tr>
</table>

<h3>SetResourcePlaceholders Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>resourceId</td>
        <td>ID of resource to set placeholders from</td>
        <td>empty (defaults to current resource)</td>
    </tr>
    <tr>
        <td>prefix</td>
        <td>Prefix for placeholders</td>
        <td>empty</td>
    </tr>
</table>

<h3>UserSearchForm Snippet Properties</h3>

<table class="properties">
    <tr>
        <th>Property</th>
        <th>Description</th>
        <th>Default</th>
    </tr>

    <tr>
        <td>extFormTpl</td>
        <td>Tpl chunk to use for user search form</td>
        <td>ExtUserSearchFormTpl</td>
    </tr>
</table>


<p>&nbsp;</p>